# No Bridge
列車位置の検知機能を搭載したい路線に列車の通過を検知するプログラム一定の期間ごとに配置し、駅に駅プログラムを配置し、ハブPC(場合によってはHTTP経由で外部に飛ばすかもしれない)で処理を行う。
## 列車の通過を検知する
プログラムには路線名と、エリア名が与えられる。
列車が入ったタイミングで、ハブPCに対して自身の鉄道名とエリア名を送信する。
## 駅
プログラムには路線名と駅の番線IDが渡される。
列車が駅に到着した際、ハブPCに対して鉄道名、駅名、駅の番線、列車名を送信する。
## ハブでの処理
プログラムには路線名と、「その路線にある全ての駅とエリアの位置関係」が渡される。
駅から通信を受け取ったとき、列車名と現在の位置と位置関係から割り出した次のエリア候補と受信時間を記録する。
通過検知プログラムから通信を受け取ったとき、列車一覧の位置関係から割り出した次のエリア候補の中に該当エリアがある、一番受信時間が早い列車を取得する。取得した列車の位置と次のエリア候補を該当エリアに置き換える。
この処理により、エリアを通過した列車名を割り出すことができる。
列車ごとに編成や貨物の有無などを記録しておけばより高度なシステムを作成できる。
ついでに位置更新を行う際に前回の更新時刻からの時間差を記録しておく。
このデータは推定時刻を指す際の算出に用いられる。